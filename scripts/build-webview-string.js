#!/usr/bin/env node

const fs = require('fs');
const path = require('path');

// Paths
const htmlPath = path.join(__dirname, '../src/apps/android/generated/index.html');
const outputPath = path.join(__dirname, '../src/shared/ui/dist/webview-content.js');

// Ensure generated directory exists
const generatedDir = path.dirname(outputPath);
if (!fs.existsSync(generatedDir)) {
  fs.mkdirSync(generatedDir, { recursive: true });
}

function buildWebViewString() {
  try {
    if (!fs.existsSync(htmlPath)) {
      console.error('HTML file not found. Please run the UI build first.');
      process.exit(1);
    }

    // Read the HTML file
    const htmlContent = fs.readFileSync(htmlPath, 'utf8');
    
    // Escape the HTML content for JavaScript
    const escapedHtml = htmlContent
      .replace(/\\/g, '\\\\')
      .replace(/`/g, '\\`')
      .replace(/\${/g, '\\${');
    
    // Create the JavaScript module (CommonJS format for React Native)
    const jsContent = `// Auto-generated WebView HTML content
// Do not edit this file directly - it will be overwritten
module.exports = \`${escapedHtml}\`;
`;

    // Write the JavaScript file
    fs.writeFileSync(outputPath, jsContent, 'utf8');
    
    console.log('‚úÖ WebView HTML string generated successfully');
    console.log(`üìÅ Output: ${outputPath}`);
  } catch (error) {
    console.error('‚ùå Error building WebView string:', error);
    process.exit(1);
  }
}

buildWebViewString();