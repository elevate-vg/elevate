<!doctype html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      html {
        background: #1a1a2e;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        padding: 20px;
        margin: 0;
        background: linear-gradient(
          135deg,
          #1a1a2e 0%,
          #16213e 50%,
          #0f3460 100%
        );
        color: white;
        min-height: 100vh;
        opacity: 0;
        animation: fadeIn 0.3s ease-in forwards;
        animation-delay: 0.1s;
      }
      @keyframes fadeIn {
        to {
          opacity: 1;
        }
      }
      .header {
        text-align: center;
        margin-bottom: 30px;
      }
      .logo {
        font-size: 3em;
        margin-bottom: 10px;
      }
      h1 {
        margin: 0;
        font-size: 2.5em;
        background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      .subtitle {
        font-size: 1.2em;
        opacity: 0.8;
        margin: 10px 0 0 0;
      }
      .launcher-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 30px;
      }
      .game-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 25px;
        border-radius: 15px;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
      }
      .game-card:hover, .game-card.focused {
        transform: translateY(-5px);
        background: rgba(255, 255, 255, 0.15);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }
      .game-card.focused {
        border: 2px solid #4ecdc4;
        box-shadow: 0 0 20px rgba(78, 205, 196, 0.4), 0 10px 30px rgba(0, 0, 0, 0.3);
      }
      .game-icon {
        font-size: 4em;
        margin-bottom: 15px;
        display: block;
      }
      .game-title {
        font-size: 1.5em;
        font-weight: bold;
        margin-bottom: 10px;
      }
      .game-description {
        opacity: 0.8;
        margin-bottom: 20px;
        line-height: 1.4;
      }
      .launch-btn {
        background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        font-size: 1em;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
      }
      .launch-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
      }
      .launch-btn:active {
        transform: scale(0.98);
      }
      .launch-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }
      .status {
        text-align: center;
        margin-top: 20px;
        padding: 15px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        font-family: "Courier New", monospace;
      }
      .quick-actions {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 30px;
        flex-wrap: wrap;
      }
      .quick-btn {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.9em;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .quick-btn:hover {
        background: rgba(255, 255, 255, 0.2);
      }
      .settings-card {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
      }
      .input-group {
        margin-bottom: 15px;
      }
      .input-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        opacity: 0.9;
      }
      .input-group input {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 5px;
        background: rgba(0, 0, 0, 0.3);
        color: white;
        font-size: 0.9em;
      }
      .input-group input::placeholder {
        color: rgba(255, 255, 255, 0.5);
      }
      .gamepad-demo {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
      }
      .gamepad-status {
        text-align: center;
        margin-bottom: 20px;
        padding: 10px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 5px;
      }
      .gamepad-connected {
        color: #4ecdc4;
      }
      .gamepad-disconnected {
        color: #ff6b6b;
      }
      .gamepad-layout {
        display: grid;
        grid-template-columns: 1fr 200px 1fr;
        gap: 20px;
        align-items: center;
        margin: 20px 0;
      }
      .dpad-container, .buttons-container {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 5px;
        width: 120px;
        height: 120px;
        margin: 0 auto;
      }
      .dpad-btn, .gamepad-btn {
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        color: white;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.1s ease;
        font-size: 14px;
      }
      .dpad-btn.pressed, .gamepad-btn.pressed {
        background: #4ecdc4;
        border-color: #4ecdc4;
        transform: scale(0.95);
        box-shadow: 0 0 15px rgba(78, 205, 196, 0.5);
      }
      .dpad-up { grid-column: 2; grid-row: 1; }
      .dpad-left { grid-column: 1; grid-row: 2; }
      .dpad-right { grid-column: 3; grid-row: 2; }
      .dpad-down { grid-column: 2; grid-row: 3; }
      .btn-y { grid-column: 2; grid-row: 1; }
      .btn-x { grid-column: 1; grid-row: 2; }
      .btn-b { grid-column: 3; grid-row: 2; }
      .btn-a { grid-column: 2; grid-row: 3; }
      .analog-sticks {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        gap: 20px;
      }
      .stick-container {
        position: relative;
        width: 80px;
        height: 80px;
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .stick-indicator {
        position: absolute;
        width: 20px;
        height: 20px;
        background: #4ecdc4;
        border-radius: 50%;
        transition: all 0.1s ease;
        box-shadow: 0 0 10px rgba(78, 205, 196, 0.5);
      }
      .triggers {
        display: flex;
        justify-content: space-between;
        margin-top: 15px;
      }
      .trigger {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
      }
      .trigger-bar {
        width: 60px;
        height: 10px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 5px;
        overflow: hidden;
      }
      .trigger-fill {
        height: 100%;
        background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
        transition: width 0.1s ease;
        width: 0%;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="logo">üéÆ</div>
      <h1>RetroArch Launcher</h1>
      <p class="subtitle">Launch RetroArch games directly from your WebView</p>
    </div>

    <div class="launcher-grid">
      <div class="game-card" data-nav-id="0" onclick="launchRetroArch('gba', 'mgba')">
        <div class="game-icon">üè∞</div>
        <div class="game-title">Game Boy Advance</div>
        <div class="game-description">Launch GBA games with mGBA core</div>
        <button class="launch-btn">Launch GBA Game</button>
      </div>

      <div class="game-card" data-nav-id="1" onclick="writeFile()">
        <div class="game-icon">üìù</div>
        <div class="game-title">Write YAML</div>
        <div class="game-description">
          Write a YAML file to document directory
        </div>
        <button class="launch-btn">Write YAML</button>
      </div>

      <div class="game-card" data-nav-id="2" onclick="readFile()">
        <div class="game-icon">üìä</div>
        <div class="game-title">Read YAML</div>
        <div class="game-description">
          Read and parse YAML file from document directory
        </div>
        <button class="launch-btn">Read YAML</button>
      </div>

      <div class="game-card" data-nav-id="3" onclick="toggleGamepadDemo()">
        <div class="game-icon">üéÆ</div>
        <div class="game-title">Gamepad Demo</div>
        <div class="game-description">
          Test gamepad controls and view input visualization
        </div>
        <button class="launch-btn">Toggle Gamepad Demo</button>
      </div>
    </div>

    <div class="settings-card">
      <h3>ROM Settings</h3>
      <div class="input-group">
        <label for="romPath">ROM Path:</label>
        <input
          type="text"
          id="romPath"
          placeholder="/storage/emulated/0/Download/game.zip"
          value="/storage/emulated/0/Download/minish.zip"
        />
      </div>
      <div class="input-group">
        <label for="configPath">Config Path:</label>
        <input
          type="text"
          id="configPath"
          placeholder="/storage/emulated/0/Android/data/com.retroarch.aarch64/files/retroarch.cfg"
          value="/storage/emulated/0/Android/data/com.retroarch.aarch64/files/retroarch.cfg"
        />
      </div>
    </div>

    <div class="quick-actions">
      <button
        class="quick-btn"
        onclick="sendMessage('Open RetroArch Settings')"
      >
        ‚öôÔ∏è Settings
      </button>
      <button class="quick-btn" onclick="sendMessage('Scan ROMs')">
        üìÅ Scan ROMs
      </button>
      <button class="quick-btn" onclick="sendMessage('Show Saves')">
        üíæ Save States
      </button>
      <button class="quick-btn" onclick="sendMessage('Controls')">
        üéÆ Controls
      </button>
      <button class="quick-btn" onclick="sendMessage('About')">‚ÑπÔ∏è About</button>
    </div>

    <div class="status" id="status">Ready to launch RetroArch games...</div>

    <div class="gamepad-demo" id="gamepadDemo" style="display: none;">
      <h3>üéÆ Gamepad Controls Demo</h3>
      <div class="gamepad-status" id="gamepadStatus">
        <span class="gamepad-disconnected">No gamepad detected. Connect a gamepad and press any button.</span>
      </div>
      
      <div class="gamepad-layout">
        <!-- D-Pad -->
        <div class="dpad-container">
          <div class="dpad-btn dpad-up" id="dpad-up">‚Üë</div>
          <div class="dpad-btn dpad-left" id="dpad-left">‚Üê</div>
          <div class="dpad-btn dpad-right" id="dpad-right">‚Üí</div>
          <div class="dpad-btn dpad-down" id="dpad-down">‚Üì</div>
        </div>

        <!-- Analog Sticks -->
        <div class="analog-sticks">
          <div class="stick-container">
            <div class="stick-indicator" id="leftStick"></div>
            <small>L</small>
          </div>
          <div class="stick-container">
            <div class="stick-indicator" id="rightStick"></div>
            <small>R</small>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="buttons-container">
          <div class="gamepad-btn btn-y" id="btn-y">Y</div>
          <div class="gamepad-btn btn-x" id="btn-x">X</div>
          <div class="gamepad-btn btn-b" id="btn-b">B</div>
          <div class="gamepad-btn btn-a" id="btn-a">A</div>
        </div>
      </div>

      <!-- Triggers -->
      <div class="triggers">
        <div class="trigger">
          <small>LT</small>
          <div class="trigger-bar">
            <div class="trigger-fill" id="leftTrigger"></div>
          </div>
        </div>
        <div class="trigger">
          <small>RT</small>
          <div class="trigger-bar">
            <div class="trigger-fill" id="rightTrigger"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      function updateStatus(message) {
        document.getElementById("status").textContent = message;
      }

      function launchRetroArch(console, core) {
        const romPath = document.getElementById("romPath").value;
        const configPath = document.getElementById("configPath").value;

        updateStatus(
          `Launching ${console.toUpperCase()} game with ${core} core...`,
        );

        const launchConfig = {
          type: "LAUNCH_RETROARCH",
          console: console,
          core: core,
          romPath: romPath,
          configPath: configPath,
          timestamp: new Date().toISOString(),
        };

        if (window.ReactNativeWebView) {
          window.ReactNativeWebView.postMessage(JSON.stringify(launchConfig));
        } else {
          updateStatus("Error: ReactNativeWebView not available");
        }
      }

      function openRetroArchMain() {
        updateStatus("Opening RetroArch main interface...");

        const message = {
          type: "OPEN_RETROARCH_MAIN",
          timestamp: new Date().toISOString(),
        };

        if (window.ReactNativeWebView) {
          window.ReactNativeWebView.postMessage(JSON.stringify(message));
        } else {
          updateStatus("Error: ReactNativeWebView not available");
        }
      }

      function writeFile() {
        const content = `Hello from WebView! Current time: ${new Date().toISOString()}`;
        updateStatus("Requesting YAML file write...");

        const message = {
          type: "WRITE_FILE",
          content: content,
          timestamp: new Date().toISOString(),
        };

        if (window.ReactNativeWebView) {
          window.ReactNativeWebView.postMessage(JSON.stringify(message));
        } else {
          updateStatus("Error: ReactNativeWebView not available");
        }
      }

      function readFile() {
        updateStatus("Requesting YAML file read...");

        const message = {
          type: "READ_FILE",
          timestamp: new Date().toISOString(),
        };

        if (window.ReactNativeWebView) {
          window.ReactNativeWebView.postMessage(JSON.stringify(message));
        } else {
          updateStatus("Error: ReactNativeWebView not available");
        }
      }

      function sendMessage(action) {
        updateStatus(`Action: ${action}`);

        const message = {
          type: "RETROARCH_ACTION",
          action: action,
          timestamp: new Date().toISOString(),
        };

        if (window.ReactNativeWebView) {
          window.ReactNativeWebView.postMessage(JSON.stringify(message));
        } else {
          updateStatus("Error: ReactNativeWebView not available");
        }
      }

      // Listen for messages from React Native
      function handleMessage(event) {
        try {
          let data;
          if (typeof event.data === "string") {
            try {
              data = JSON.parse(event.data);
            } catch {
              data = { text: event.data, type: "SIMPLE_MESSAGE" };
            }
          } else {
            data = event.data;
          }

          if (data.type === "LAUNCH_STATUS") {
            updateStatus(data.message);
          } else if (data.type === "ERROR") {
            updateStatus(`Error: ${data.message}`);
          } else if (data.type === "FILE_WRITE_SUCCESS") {
            updateStatus(`‚úÖ ${data.message}`);
          } else if (data.type === "FILE_READ_SUCCESS") {
            updateStatus(`üìñ File content: ${data.message}`);
          } else if (data.type === "FILE_READ_ERROR") {
            updateStatus(`‚ùå ${data.message}`);
          } else {
            updateStatus(`Received: ${data.text || event.data}`);
          }
        } catch (error) {
          console.error("Error processing message:", error);
        }
      }

      // Set up message listeners
      document.addEventListener("message", handleMessage);
      window.addEventListener("message", handleMessage);

      // Gamepad Demo Variables
      let gamepadDemo = {
        active: false,
        connectedGamepads: {},
        animationFrame: null,
        deadzone: 0.1
      };

      // Navigation Variables
      let navigation = {
        currentIndex: 0,
        maxIndex: 3, // 4 cards (0-3)
        lastInputTime: 0,
        inputDelay: 200, // ms between navigation inputs
        previousButtonStates: {
          dpadUp: false,
          dpadDown: false,
          dpadLeft: false,
          dpadRight: false,
          buttonA: false
        }
      };

      // Gamepad Demo Functions
      function toggleGamepadDemo() {
        const demoElement = document.getElementById('gamepadDemo');
        gamepadDemo.active = !gamepadDemo.active;
        
        if (gamepadDemo.active) {
          demoElement.style.display = 'block';
          startGamepadPolling();
          updateStatus('Gamepad demo started! Connect a gamepad and press buttons.');
        } else {
          demoElement.style.display = 'none';
          stopGamepadPolling();
          updateStatus('Gamepad demo stopped.');
        }
      }

      function startGamepadPolling() {
        function pollGamepads() {
          const gamepads = navigator.getGamepads();
          let connectedCount = 0;
          
          for (let i = 0; i < gamepads.length; i++) {
            const gamepad = gamepads[i];
            if (gamepad) {
              connectedCount++;
              
              // Handle navigation for all gamepads (not just when demo is active)
              handleGamepadNavigation(gamepad);
              
              // Only update demo display when demo is active
              if (gamepadDemo.active) {
                updateGamepadDisplay(gamepad, i);
              }
            }
          }
          
          if (gamepadDemo.active) {
            updateGamepadStatus(connectedCount);
          }
          
          gamepadDemo.animationFrame = requestAnimationFrame(pollGamepads);
        }
        
        pollGamepads();
      }

      function stopGamepadPolling() {
        if (gamepadDemo.animationFrame) {
          cancelAnimationFrame(gamepadDemo.animationFrame);
          gamepadDemo.animationFrame = null;
        }
        resetGamepadDisplay();
      }

      function updateGamepadStatus(connectedCount) {
        const statusElement = document.getElementById('gamepadStatus');
        if (connectedCount > 0) {
          statusElement.innerHTML = `<span class="gamepad-connected">üéÆ ${connectedCount} gamepad(s) connected</span>`;
        } else {
          statusElement.innerHTML = `<span class="gamepad-disconnected">No gamepad detected. Connect a gamepad and press any button.</span>`;
        }
      }

      function updateGamepadDisplay(gamepad, index) {
        // Update D-Pad
        updateButton('dpad-up', gamepad.buttons[12]?.pressed);
        updateButton('dpad-down', gamepad.buttons[13]?.pressed);
        updateButton('dpad-left', gamepad.buttons[14]?.pressed);
        updateButton('dpad-right', gamepad.buttons[15]?.pressed);
        
        // Update Action Buttons (Xbox layout)
        updateButton('btn-a', gamepad.buttons[0]?.pressed);  // A
        updateButton('btn-b', gamepad.buttons[1]?.pressed);  // B
        updateButton('btn-x', gamepad.buttons[2]?.pressed);  // X
        updateButton('btn-y', gamepad.buttons[3]?.pressed);  // Y
        
        // Update Triggers
        updateTrigger('leftTrigger', gamepad.buttons[6]?.value || 0);
        updateTrigger('rightTrigger', gamepad.buttons[7]?.value || 0);
        
        // Update Analog Sticks
        updateAnalogStick('leftStick', gamepad.axes[0] || 0, gamepad.axes[1] || 0);
        updateAnalogStick('rightStick', gamepad.axes[2] || 0, gamepad.axes[3] || 0);
      }

      function updateButton(elementId, pressed) {
        const element = document.getElementById(elementId);
        if (element) {
          if (pressed) {
            element.classList.add('pressed');
          } else {
            element.classList.remove('pressed');
          }
        }
      }

      function updateTrigger(elementId, value) {
        const element = document.getElementById(elementId);
        if (element) {
          const percentage = Math.max(0, Math.min(100, value * 100));
          element.style.width = `${percentage}%`;
        }
      }

      function updateAnalogStick(elementId, x, y) {
        const element = document.getElementById(elementId);
        if (element) {
          // Apply deadzone
          const magnitude = Math.sqrt(x * x + y * y);
          if (magnitude < gamepadDemo.deadzone) {
            x = 0;
            y = 0;
          }
          
          // Convert to pixel positions (40px is half of 80px container)
          const maxOffset = 25; // Maximum pixels from center
          const pixelX = x * maxOffset;
          const pixelY = y * maxOffset;
          
          element.style.transform = `translate(${pixelX}px, ${pixelY}px)`;
        }
      }

      function resetGamepadDisplay() {
        // Reset all buttons
        const buttons = document.querySelectorAll('.dpad-btn, .gamepad-btn');
        buttons.forEach(btn => btn.classList.remove('pressed'));
        
        // Reset triggers
        document.getElementById('leftTrigger').style.width = '0%';
        document.getElementById('rightTrigger').style.width = '0%';
        
        // Reset analog sticks
        document.getElementById('leftStick').style.transform = 'translate(0px, 0px)';
        document.getElementById('rightStick').style.transform = 'translate(0px, 0px)';
      }

      // Navigation Functions
      function handleGamepadNavigation(gamepad) {
        const currentTime = Date.now();
        
        // Check for D-pad input
        const dpadUp = gamepad.buttons[12]?.pressed || false;
        const dpadDown = gamepad.buttons[13]?.pressed || false;
        const dpadLeft = gamepad.buttons[14]?.pressed || false;
        const dpadRight = gamepad.buttons[15]?.pressed || false;
        
        // Check for analog stick input (with deadzone)
        const leftStickX = gamepad.axes[0] || 0;
        const leftStickY = gamepad.axes[1] || 0;
        const analogUp = leftStickY < -0.5;
        const analogDown = leftStickY > 0.5;
        const analogLeft = leftStickX < -0.5;
        const analogRight = leftStickX > 0.5;
        
        // Combine D-pad and analog inputs
        const moveUp = dpadUp || analogUp;
        const moveDown = dpadDown || analogDown;
        const moveLeft = dpadLeft || analogLeft;
        const moveRight = dpadRight || analogRight;
        
        // Check for A button
        const buttonA = gamepad.buttons[0]?.pressed || false;
        
        // Handle navigation with input delay
        if (currentTime - navigation.lastInputTime > navigation.inputDelay) {
          // Detect rising edge (button just pressed)
          if (moveUp && !navigation.previousButtonStates.dpadUp) {
            navigateUp();
            navigation.lastInputTime = currentTime;
          } else if (moveDown && !navigation.previousButtonStates.dpadDown) {
            navigateDown();
            navigation.lastInputTime = currentTime;
          } else if (moveLeft && !navigation.previousButtonStates.dpadLeft) {
            navigateLeft();
            navigation.lastInputTime = currentTime;
          } else if (moveRight && !navigation.previousButtonStates.dpadRight) {
            navigateRight();
            navigation.lastInputTime = currentTime;
          }
        }
        
        // Handle A button (activate)
        if (buttonA && !navigation.previousButtonStates.buttonA) {
          activateCurrentCard();
        }
        
        // Store previous states for edge detection
        navigation.previousButtonStates = {
          dpadUp: moveUp,
          dpadDown: moveDown,
          dpadLeft: moveLeft,
          dpadRight: moveRight,
          buttonA: buttonA
        };
      }

      function navigateUp() {
        if (navigation.currentIndex >= 2) { // Top row
          navigation.currentIndex -= 2;
          updateFocusedCard();
        }
      }

      function navigateDown() {
        if (navigation.currentIndex < 2) { // Bottom row
          navigation.currentIndex += 2;
          updateFocusedCard();
        }
      }

      function navigateLeft() {
        if (navigation.currentIndex % 2 === 1) { // Right column
          navigation.currentIndex -= 1;
          updateFocusedCard();
        }
      }

      function navigateRight() {
        if (navigation.currentIndex % 2 === 0) { // Left column
          navigation.currentIndex += 1;
          updateFocusedCard();
        }
      }

      function updateFocusedCard() {
        // Remove focus from all cards
        const allCards = document.querySelectorAll('.game-card');
        allCards.forEach(card => card.classList.remove('focused'));
        
        // Add focus to current card
        const currentCard = document.querySelector(`[data-nav-id="${navigation.currentIndex}"]`);
        if (currentCard) {
          currentCard.classList.add('focused');
          currentCard.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
      }

      function activateCurrentCard() {
        const currentCard = document.querySelector(`[data-nav-id="${navigation.currentIndex}"]`);
        if (currentCard) {
          // Trigger the click event
          currentCard.click();
          
          // Visual feedback
          currentCard.style.transform = 'translateY(-5px) scale(0.98)';
          setTimeout(() => {
            currentCard.style.transform = '';
          }, 150);
        }
      }

      // Initialize navigation focus
      function initializeNavigation() {
        updateFocusedCard();
        // Start gamepad polling immediately for navigation
        if (!gamepadDemo.animationFrame) {
          startGamepadPolling();
        }
      }

      // Gamepad event listeners
      window.addEventListener('gamepadconnected', (event) => {
        console.log('Gamepad connected:', event.gamepad.id);
        updateStatus(`Gamepad connected: ${event.gamepad.id} - Use D-pad/analog + A to navigate`);
      });

      window.addEventListener('gamepaddisconnected', (event) => {
        console.log('Gamepad disconnected:', event.gamepad.id);
        updateStatus(`Gamepad disconnected: ${event.gamepad.id}`);
      });

      // Initialize
      updateStatus(
        "RetroArch Launcher ready! Configure your ROM path and select a game to launch.",
      );
      
      // Initialize navigation on page load
      initializeNavigation();
    </script>
  </body>
</html>

